<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Detalhe do Post</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
  <div class="container mt-5">
    <a href="index.html" class="btn btn-secondary mb-4" aria-label="Voltar para a página principal">Voltar</a>

    <div id="postContent" class="mb-5">
      <!-- Conteúdo do post será exibido aqui -->
    </div>

    <h3>Comentários</h3>
    <div id="comments" class="list-group mb-4">
      <!-- Comentários serão listados aqui -->
    </div>

    <form id="commentForm">
      <div class="mb-3">
        <label for="comment" class="form-label">Adicionar Comentário</label>
        <textarea class="form-control" id="comment" rows="3" required></textarea>
      </div>
      <button type="submit" class="btn btn-success">Enviar Comentário</button>
    </form>
  </div>

  <script src="storage.js"></script>
  <script>
    function getQueryParam(param) {
      const urlParams = new URLSearchParams(window.location.search);
      return urlParams.get(param);
    }

    function generateId() {
      return Date.now().toString(36) + Math.random().toString(36).substring(2);
    }

    function renderPost() {
      const postIdParam = getQueryParam('id');
      const postId = parseInt(postIdParam);

      if (isNaN(postId)) {
        document.getElementById('postContent').innerHTML = '<p class="text-danger">ID do post inválido.</p>';
        return;
      }

      const posts = getPosts();
      const post = posts.find(p => p.id === postId);
      const postContainer = document.getElementById('postContent');

      if (post) {
        const h1 = document.createElement('h1');
        h1.textContent = post.title;

        const p = document.createElement('p');
        p.textContent = post.content;

        postContainer.innerHTML = '';
        postContainer.appendChild(h1);
        postContainer.appendChild(p);
      } else {
        postContainer.innerHTML = '<p class="text-danger">Post não encontrado.</p>';
      }
    }

    function renderComments() {
      const postIdParam = getQueryParam('id');
      const postId = parseInt(postIdParam);

        if (isNaN(postId)) {
          document.getElementById('comments').innerHTML = '<p class="text-danger">ID do post inválido.</p>';
          return;
        }

      const comments = getComments().filter(c => c.postId === postId);
      const commentsContainer = document.getElementById('comments');

      commentsContainer.innerHTML = '';

      if (comments.length === 0) {
        commentsContainer.innerHTML = '<p class="text-muted">Nenhum comentário ainda.</p>';
      } else {
        const fragment = document.createDocumentFragment(); // Cria um fragmento para melhor performance

        comments.forEach(comment => {
          const commentItem = document.createElement('div');
          commentItem.className = "list-group-item";
          commentItem.textContent = comment.text;
          fragment.appendChild(commentItem);
        });

        commentsContainer.appendChild(fragment);
      }
    }

    document.getElementById('commentForm').addEventListener('submit', function(e) {
      e.preventDefault();

      const commentText = document.getElementById('comment').value.trim();

      if (!commentText) {
        alert("Por favor, insira um comentário.");
        return;
      }

      const postIdParam = getQueryParam('id');
      const postId = parseInt(postIdParam);

        if (isNaN(postId)) {
          alert("ID do post inválido.")
          return;
        }

      const newComment = {
        id: generateId(),
        postId: postId,
        text: commentText
      };

      const comments = getComments();
      comments.push(newComment);
      saveComments(comments);

      document.getElementById('comment').value = '';
      renderComments();
    });

    document.addEventListener('DOMContentLoaded', function() {
      renderPost();
      renderComments();
    });
  </script>
</body>
</html>